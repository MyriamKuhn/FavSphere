RewriteEngine On
RewriteBase /

# Redirige toutes les requêtes HTTP vers HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirige toutes les requêtes vers index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# Redirige l'accès à /app/ vers /app/swagger/
RewriteCond %{REQUEST_URI} ^/app/$
RewriteRule ^ /app/swagger/ [L,R=301]

# Bloque l'accès aux fichiers .htaccess et .htpasswd
<Files ".ht*">
    Require all denied
</Files>

# Bloquer l'accès au fichier .env
<Files ".env">
    Require all denied
</Files>

# Permet au serveur de pouvoir transmettre l'en-tête correctement à PHP
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

<IfModule mod_headers.c>
Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.datatables.net https://cdnjs.cloudflare.com https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js; style-src 'self' 'unsafe-inline' https://cdn.datatables.net/v/bs5/jq-3.7.0/jszip-3.10.1/dt-2.1.7/b-3.1.2/b-html5-3.1.2/r-3.0.3/datatables.min.css https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; frame-src 'self'; frame-ancestors 'none'; upgrade-insecure-requests;"
</IfModule>
